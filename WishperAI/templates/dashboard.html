{% extends "base.html" %}

{% block title %}Admin Dashboard{% endblock %}
{% block head %}
{{ super() }}

{% endblock %}

{% block content %}

<div class="container mt-5">
      <div class="dashboard_inner_sec">
        <h1 class="Dashboard_hding">Dashboard</h1>
        <div class="row">
          <div class="col-lg-3 col-md-6 mb-3">
            <div class="recent_activies_div" data-bs-toggle="modal" data-bs-target="#AddNew-btn">
              <h2 class="recent_activies_num"><i class="bi bi-plus"></i></h2>
                <!-- Button trigger modal -->
                <button type="button" class="btn recent_activies">
                  Add New User 
                </button>
            </div>
          </div>
          <div class="col-lg-3 col-md-6 mb-3">
            <div class="recent_activies_div" data-bs-toggle="modal" data-bs-target="#AddNew-btn">
              <a href="/add/address" class="">
                <h2 class="recent_activies_num"><i class="bi bi-plus"></i></h2>
                  <!-- Button trigger modal -->
                  <button type="button" class="btn recent_activies">
                    Add User Address
                  </button>
              </a>
            </div>
          </div>
          <div class="col-lg-3 col-md-6 mb-3">
            <div class="recent_activies_div">
              <a href="/face_capture" class="">
                <h2 class="recent_activies_num"><i class="bi bi-upc-scan"></i></h2>
                  <!-- Button trigger modal -->
                  <button type="button" class="btn recent_activies">
                    Capture User Face
                  </button>
              </a>
            </div>
          </div>
          <div class="col-lg-3 col-md-6 mb-3">
            <div class="recent_activies_div">
              <a href="/face_recognition" target="_blank" class="">
                <h2 class="recent_activies_num"><i class="bi bi-upc-scan"></i></h2>
                  <!-- Button trigger modal -->
                  <button type="button" class="btn recent_activies">
                    Recognize Face
                  </button>
              </a>
            </div>
          </div>
          <div class="col-lg-3 col-md-6 mb-3">
            <div class="recent_activies_div">
              <a href="/all/users" class="">
                <h2 class="recent_activies_num all_user_cls">0</h2>
                <p class="recent_activies">All Users</p>
              </a> 
            </div>
          </div>
          <div class="col-lg-3 col-md-6 mb-3">
            <div class="recent_activies_div train_model loader_div">
              <a href="#" class="">
                <img src="{{ url_for('static', path='/images/iot.png') }}" class="train_img">
                <p class="recent_activies">Train Model</p>
              </a>
            </div>
          </div>
        </div>

          
          <!-- Modal -->
              <div class="modal fade" id="AddNew-btn" tabindex="-1" aria-labelledby="AddNew-label" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="AddNew-label">Create User</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                     <form class="form_of_Addnew">
                        <div class="row">
                          <div class="col-md-6">
                            <div class="input_lbl_addnew">
                            <label class="Addnew_label">First Name</label>
                            <input type="text" class="form-control Addnew_input first_name" placeholder="First Name">
                            <span class="error"></span>
                          </div>
                          </div>
                          <div class="col-md-6">
                            <div class="input_lbl_addnew">
                            <label class="Addnew_label">Last Name</label>
                            <input type="text" class="form-control Addnew_input last_name" placeholder="Last Name">
                            <span class="error"></span>
                          </div>
                          </div>

                          <div class="col-md-6">
                            <div class="input_lbl_addnew">
                            <label class="Addnew_label">Email</label>
                            <input type="text" class="form-control Addnew_input input_email" placeholder="Email">
                            <span class="error"></span>
                          </div>
                          </div>
                          <div class="col-md-6">
                            <div class="input_lbl_addnew">
                            <label class="Addnew_label">Password</label>
                            <input type="password" class="form-control Addnew_input input_password " placeholder="Password">
                            <span class="error"></span>
                          </div>
                          </div>
                        </div>
                      </form>
                    </div>
                    <div class="modal-footer border-0">
                      <button type="button" class="btn cancel_btn" data-bs-dismiss="modal">Close</button>
                      <button type="button" class="btn Addnew-savebtn create-userbtn">Save changes</button>
                    </div>
                  </div>
                </div>
              </div>
        </div>
        <div class="text-center train_recognition_model">
          <div class="alert alert-success alert-dismissible text-message fade show" role="alert">
            Model has been trained successfully!
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        </div>
   </div>
   </div>
   <div class="loading">
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="margin: auto; display: block;" width="200px" height="200px" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid">
<style type="text/css">
  .ldio-lw02wgdvat-st0{opacity:0.8;fill:none;stroke-width:0.4811;stroke-miterlimit:10;}
  .ldio-lw02wgdvat-st2{opacity:0.8;}
  .ldio-lw02wgdvat-st3{fill:none;stroke-width:0.5;stroke-miterlimit:10;}
  .ldio-lw02wgdvat-st4{fill:none;stroke-width:0.4694;stroke-miterlimit:10;}
</style>
<g style="opacity:0.5">
  <polygon stroke="#799b79" class="ldio-lw02wgdvat-st0" points="41.5 62 30 62 24.2 72 30 82 41.5 82 47.3 72"></polygon>
  <polygon stroke="#799b79" class="ldio-lw02wgdvat-st0" points="58.8 72 47.3 72 41.5 82 47.3 92 58.8 92 64.6 82"></polygon>
  <polygon stroke="#799b79" class="ldio-lw02wgdvat-st0" points="76.2 62 64.6 62 58.8 72 64.6 82 76.2 82 81.9 72"></polygon>
  <polygon stroke="#799b79" class="ldio-lw02wgdvat-st0" points="41.5 42 30 42 24.2 52 30 62 41.5 62 47.3 52"></polygon>
  <polygon stroke="#799b79" class="ldio-lw02wgdvat-st0" points="58.8 12 47.3 12 41.5 22 47.3 32 58.8 32 64.6 22"></polygon>
  <polygon stroke="#799b79" class="ldio-lw02wgdvat-st0" points="58.8 32 47.3 32 41.5 42 47.3 52 58.8 52 64.6 42"></polygon>
  <polygon stroke="#799b79" class="ldio-lw02wgdvat-st0" points="76.2 22 64.6 22 58.8 32 64.6 42 76.2 42 81.9 32"></polygon>
</g>
<g>
  <path fill="#044f4e" d="M48.3 56.8l-4.4 1.5c-0.9-1.3-1.5-2.7-1.7-4.3l-1.9 0.3c0.5 2.6 1.7 5 3.6 6.9c1.9 1.9 4.3 3.1 6.9 3.6 l0.3-1.9c-1.6-0.3-3-0.9-4.3-1.7L48.3 56.8z"></path>
  <path fill="#044f4e" d="M57.8 47.2l4.4-1.5c0.9 1.3 1.5 2.7 1.7 4.3l1.9-0.3c-0.5-2.6-1.7-5-3.6-6.9c-1.9-1.9-4.3-3.1-6.9-3.6L55 41.1 c1.6 0.3 3 0.9 4.3 1.7L57.8 47.2z"></path>
  <path fill="#044f4e" d="M62.2 58.2l-4.4-1.5l1.5 4.4C58 62 56.5 62.6 55 62.9l0.3 1.9c2.6-0.5 5-1.7 6.9-3.6c1.9-1.9 3.1-4.3 3.6-6.9 L64 53.9C63.7 55.5 63.1 56.9 62.2 58.2z"></path>
  <path fill="#044f4e" d="M43.9 42.8c-1.9 1.9-3.1 4.3-3.6 6.9l1.9 0.3c0.3-1.6 0.9-3 1.7-4.3l4.4 1.5l-1.5-4.4c1.3-0.9 2.7-1.5 4.3-1.7 l-0.3-1.9C48.2 39.7 45.8 40.9 43.9 42.8z"></path>
  <animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="4s" keyTimes="0;1" values="0 53.064 52;360 53.064 52"></animateTransform>
</g>
<g class="ldio-lw02wgdvat-st2">
  <path fill="#044f4e" d="M36 61.9c-1.7-3-2.7-6.4-2.7-9.9c0-10.9 8.8-19.7 19.7-19.7v1c-10.3 0-18.8 8.4-18.8 18.8 c0 3.3 0.9 6.5 2.5 9.4L36 61.9z"></path>
  <animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="2s" keyTimes="0;1" values="360 53.064 52;0 53.064 52"></animateTransform>
</g>
<g class="ldio-lw02wgdvat-st2">
  <path fill="#044f4e" d="M57 75.3l-0.5-3c9.9-1.7 17.2-10.2 17.2-20.3c0-11.4-9.2-20.6-20.6-20.6S32.5 40.6 32.5 52 c0 1.6 0.2 3.2 0.5 4.7l-3 0.7c-0.4-1.8-0.6-3.6-0.6-5.4c0-13.1 10.6-23.7 23.7-23.7S76.7 38.9 76.7 52 C76.7 63.6 68.4 73.4 57 75.3z"></path>
  <animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1.332s" keyTimes="0;1" values="0 53.064 52;360 53.064 52"></animateTransform>
</g>
<g>
  <path fill="#044f4e" d="M90.5 45.4c-1.5-8.8-6.2-16.8-13-22.5l0 0c-3.4-2.9-7.3-5.1-11.4-6.6s-8.5-2.3-13-2.3v2.4v1.4v2.4 c3.7 0 7.4 0.6 10.9 1.9l0.8-2.3c0 0 0 0 0 0c3.7 1.4 7.2 3.4 10.3 5.9l1.2-1.5L75 25.8c0 0 0 0 0 0l-1.5 1.8 c5.7 4.8 9.6 11.5 10.9 18.8l3.8-0.7c0 0 0 0 0 0L90.5 45.4z"></path>
  <path fill="#044f4e" d="M29.7 22l4.7 6.1c3.5-2.8 7.5-4.6 11.9-5.6l-1.7-7.5C39.2 16.2 34.2 18.5 29.7 22z"></path>
  <animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="2s" keyTimes="0;1" values="360 53.064 52;0 53.064 52"></animateTransform>
</g>
<g class="ldio-lw02wgdvat-st2">
  <path fill="#044f4e" d="M53.1 92.4v-1c21.8 0 39.5-17.7 39.5-39.5c0-21.8-17.7-39.5-39.5-39.5c-15.8 0-30 9.4-36.2 23.8L15.9 36 c6.4-14.8 21-24.4 37.1-24.4c22.3 0 40.4 18.1 40.4 40.4C93.5 74.3 75.3 92.4 53.1 92.4z"></path>
  <animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1.332s" keyTimes="0;1" values="0 53.064 52;360 53.064 52"></animateTransform>
</g>
<polygon fill="#d9534f" points="57.4 51.5 53.5 51.5 53.5 47.7 52.6 47.7 52.6 51.5 48.7 51.5 48.7 52.5 52.6 52.5 52.6 56.3 53.5 56.3 53.5 52.5 57.4 52.5 ">
  <animate attributeName="opacity" repeatCount="indefinite" dur="1.332s" keyTimes="0;0.4;0.5;0.9;1" values="0;0;1;1;0"></animate>
</polygon>
<g>
  <path fill="#044f4e" d="M39.7 28.5l0.6 1c3.9-2.2 8.3-3.4 12.8-3.4V25C48.4 25 43.7 26.2 39.7 28.5z"></path>
  <path fill="#044f4e" d="M28.6 60.6l-1.1 0.4C31.3 71.8 41.6 79 53.1 79v-1.2C42.1 77.9 32.3 70.9 28.6 60.6z"></path>
  <animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="4s" keyTimes="0;1" values="360 53.064 52;0 53.064 52"></animateTransform>
</g>
<g>
  <polyline stroke="#39ff39" class="ldio-lw02wgdvat-st3" points="35.5 77.5 27.5 89.5 24 89.5"></polyline>
  <rect stroke="#39ff39" x="7" y="86" class="ldio-lw02wgdvat-st4" width="17" height="7"></rect>
</g>
<g>
  <polyline stroke="#39ff39" class="ldio-lw02wgdvat-st4" points="59 22 69 12 82 12"></polyline>
  <circle stroke="#39ff39" class="ldio-lw02wgdvat-st4" cx="87" cy="12" r="5"></circle>
</g>
</svg>
   </div>

{% endblock %}

{% block scripts %}
{{ super() }}

<script>
var accessToken = localStorage.getItem("access_token");
if(!accessToken){
  $('.dashboard_inner_sec').hide();
}
$( function() {
   $('.loader_div').click(function(){
    $('.loading').addClass('active');
   })
} );

$('.train_recognition_model').hide();
$(document).ready(function(){
  var instance = axios.create({
      baseURL: '/',
      timeout: 1000,
      headers: {'Authorization': localStorage.getItem("access_token")}
    });
     
    instance.get('/api/users/')
    .then(response => {
      var user_count = response.data.length;
      $('.all_user_cls').html(user_count);
      return response.data;
    })
  
  $('.create-userbtn').click(function(){
    if($('.first_name').val() == '')
    {
      $('.first_name').siblings('.error').html('<p class=text-danger>Please Enter First Name</p>');
    }
    else if($('.last_name').val() == '')
    {
      $('.last_name').siblings('.error').html('<p class=text-danger>Please Enter Last Name</p>');
    }
    else if($('.input_email').val() == '')
    {
      $('.input_email').siblings('.error').html('<p class=text-danger>Please Enter Email</p>');
    }
    else if($('.input_password').val() == '')
    {
      $('.input_password').siblings('.error').html('<p class=text-danger>Please Enter Password</p>');
    }
    else{

      var userData = {
        first_name:$('.first_name').val(),
        last_name:$('.last_name').val(),
        email:$('.input_email').val(),
        password:$('.input_password').val(),
      }

      var headers = {
        'Content-Type': 'application/json',
        'Authorization': localStorage.getItem('access_token')
      }

      axios
      .post("/api/users/create", userData,{
        headers: headers
      })
      .then((res) => {
        $('#AddNew-btn').modal('hide');
        $('.Addnew-savebtn').attr('data-bs-dismiss','modal');
        $('.text-message').html(`User added Successfully.. <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>`);
        $('.train_recognition_model').show();
        console.log("User Added successfully!")
        window.location.reload();
      })
      .catch(() => {
        console.log("Oops, request failed!")
      }) 

    }
  })

  
  var headers = {
    'Authorization': localStorage.getItem("access_token")
  }


  $('.train_model').click(function(){
    axios.get('/api/recognitions/train',{
      headers:headers
    })
    .then(response => {
      $('.loading').removeClass('active');
      $('.train_recognition_model').show();
      console.log(response.data);
    })
  })

})

</script>


{% endblock %}